# TenderTracker - Система автоматизированного поиска и сбора тендеров

Система для автоматического мониторинга российских тендерных площадок с использованием ГосПлан API v2.

## Стек технологий

- **Backend**: ASP.NET Core 8.0 Web API (C#)
- **Frontend**: AngularJS 1.8 + RxJS + Bootstrap 5
- **База данных**: PostgreSQL 16
- **Контейнеризация**: Docker + Docker Compose
- **Внешняя интеграция**: ГосПлан API v2 (v2.gosplan.info)

## Функциональные возможности

### 1. Модуль управления поисковыми запросами
- CRUD операции для ключевых слов/словосочетаний
- Группировка запросов по категориям
- Реактивное управление состоянием через RxJS
- Включение/отключение активных запросов

### 2. Сервис поиска и сбора данных
- Автоматический опрос ГосПлан API каждые 30 минут
- Дедупликация найденных тендеров
- Ограничение запросов (1 запрос в секунду)
- Логирование всех операций

### 3. Модуль отображения результатов
- Таблица найденных тендеров с пагинацией
- Фильтрация по запросам, датам, ключевым словам
- Сортировка по различным полям
- Кликабельные ссылки на официальные площадки

## Структура проекта

```
TenderTracker/
├── backend/                 # ASP.NET Core Web API
│   ├── TenderTracker.API/
│   │   ├── Controllers/    # API контроллеры
│   │   ├── Services/       # Бизнес-логика
│   │   ├── Models/         # Entity модели
│   │   ├── Data/           # Entity Framework контекст
│   │   ├── Clients/        # HTTP клиенты для внешних API
│   │   ├── BackgroundServices/ # Фоновые задачи
│   │   ├── DTOs/           # Data Transfer Objects
│   │   ├── Program.cs      # Точка входа
│   │   └── appsettings.json # Конфигурация
│   └── Dockerfile          # Docker образ для backend
├── frontend/               # AngularJS приложение
│   ├── src/
│   │   ├── app/           # AngularJS компоненты и сервисы
│   │   └── index.html     # Главная страница
│   ├── nginx.conf         # Конфигурация nginx
│   └── Dockerfile         # Docker образ для frontend
├── docker/                 # Docker конфигурации
│   └── postgres/          # SQL скрипты для инициализации БД
├── docker-compose.yml      # Docker Compose конфигурация
└── README.md              # Документация
```

## Быстрый старт

### Требования

- Docker 20.10+
- Docker Compose 2.0+
- curl (для тестирования, опционально)

### Запуск системы (автоматизированный)

Используйте предоставленные скрипты для простого запуска:

**Linux/macOS:**
```bash
./run.sh up
```

**Windows:**
```cmd
run.bat up
```

**Или вручную:**
```bash
docker-compose up --build
```

### Доступ к системе

После запуска откройте браузер и перейдите по адресу:
- **Frontend**: http://localhost:8080
- **Backend API**: http://localhost:5000
- **PostgreSQL**: localhost:5432
- **Health Check**: http://localhost:5000/health

### Скрипты управления

Система включает удобные скрипты управления:

| Команда | Описание |
|---------|----------|
| `./run.sh up` / `run.bat up` | Запуск системы (по умолчанию) |
| `./run.sh down` / `run.bat down` | Остановка системы |
| `./run.sh logs` / `run.bat logs` | Просмотр логов |
| `./run.sh status` / `run.bat status` | Проверка статуса сервисов |
| `./run.sh test` / `run.bat test` | Запуск тестов системы |
| `./run.sh seed` / `run.bat seed` | Добавление тестовых данных |
| `./run.sh restart` / `run.bat restart` | Перезапуск системы |
| `./run.sh clean` / `run.bat clean` | Полная очистка (контейнеры, volumes, образы) |

### Что происходит при запуске

1. **База данных**: Создается PostgreSQL 16 с предварительно настроенными таблицами
2. **Тестовые данные**: Автоматически добавляются 10 поисковых запросов и 5 тестовых тендеров
3. **Backend**: Запускается ASP.NET Core API с Entity Framework миграциями
4. **Фоновая служба**: Запускается служба поиска тендеров (каждые 30 минут)
5. **Frontend**: Запускается AngularJS приложение на nginx
6. **Health checks**: Настраиваются проверки здоровья для всех сервисов

## API Endpoints

### Поисковые запросы
- `GET /api/searchqueries` - список всех запросов
- `GET /api/searchqueries/{id}` - получить запрос по ID
- `POST /api/searchqueries` - создать новый запрос
- `PUT /api/searchqueries/{id}` - обновить запрос
- `DELETE /api/searchqueries/{id}` - удалить запрос
- `GET /api/searchqueries/active` - получить активные запросы

### Найденные тендеры
- `GET /api/foundtenders` - список тендеров с пагинацией
- `GET /api/foundtenders/{id}` - получить тендер по ID
- `GET /api/foundtenders/count` - общее количество тендеров
- `GET /api/foundtenders/stats` - статистика

## Конфигурация

### Переменные окружения

Основные настройки можно изменить через переменные окружения в `docker-compose.yml`:

```yaml
environment:
  ConnectionStrings__DefaultConnection: "Host=postgres;Database=tendertracker;Username=postgres;Password=postgres"
  GosPlanApi__BaseUrl: "https://v2.gosplan.info/api/v2"
  GosPlanApi__RequestDelayMs: "1000"  # 1 запрос в секунду
  ASPNETCORE_ENVIRONMENT: "Development"  # Production/Development
```

### Параметры поиска

- **Интервал поиска**: каждые 30 минут (настраивается в `TenderSearchBackgroundService.cs`)
- **Лимит API**: 1 запрос в секунду (соответствует ограничениям ГосПлан API)
- **Дедупликация**: проверка по уникальному `ExternalId`
- **Retry логика**: 5 попыток подключения к БД с задержкой до 30 секунд

### Health Checks

Система включает проверки здоровья:
- **Backend**: `/health` - проверка подключения к БД
- **PostgreSQL**: автоматическая проверка готовности
- **Frontend**: проверка доступности веб-сервера

## Разработка

### Backend разработка

1. Перейдите в папку backend:
   ```bash
   cd backend/TenderTracker.API
   ```

2. Восстановите зависимости:
   ```bash
   dotnet restore
   ```

3. Запустите приложение:
   ```bash
   dotnet run
   ```

### Frontend разработка

1. Перейдите в папку frontend:
   ```bash
   cd frontend
   ```

2. Установите зависимости:
   ```bash
   npm install
   ```

3. Запустите локальный сервер:
   ```bash
   npm start
   ```

## Тестирование

### Автоматические тесты

Запустите встроенные тесты системы:
```bash
./run.sh test
```
или
```cmd
run.bat test
```

Тесты проверяют:
1. **Backend API**: доступность и health check
2. **База данных**: подключение и выполнение запросов
3. **Frontend**: доступность и наличие контента

### Критерии приемки

1. **Добавление поискового запроса**:
   - Пользователь добавляет ключевое слово через интерфейс AngularJS
   - Запрос сохраняется в базе данных через REST API
   - Запрос появляется в списке активных запросов в реальном времени (RxJS)

2. **Автоматический поиск тендеров**:
   - Фоновая служба запускается каждые 30 минут
   - Система ищет тендеры по активным запросам через ГосПлан API
   - Найденные тендеры сохраняются в БД с дедупликацией

3. **Дедупликация**:
   - Повторный поиск по тому же запросу не создает дубликатов
   - Проверка осуществляется по уникальному `ExternalId`
   - Гарантируется уникальность на уровне БД (UNIQUE constraint)

4. **Отображение результатов**:
   - Найденные тендеры отображаются в таблице с пагинацией
   - Номер закупки является кликабельной ссылкой
   - Ссылка ведет на официальную площадку (zakupki.gov.ru)
   - Фильтрация и сортировка работают в реальном времени

### Тестовые данные

При первом запуске система автоматически создает:
- 10 тестовых поисковых запросов в различных категориях
- 5 тестовых тендеров для демонстрации функциональности

Для добавления дополнительных тестовых данных:
```bash
./run.sh seed
```

## Мониторинг и логирование

- **Backend**: логирование через ILogger (консоль)
- **Frontend**: консоль браузера + обработка ошибок через RxJS
- **База данных**: логирование запросов через Entity Framework

## Безопасность

- CORS настроен только для frontend приложения
- Нет аутентификации (открытый доступ согласно требованиям)
- Все конфиденциальные данные через переменные окружения

## Производительность

- **Frontend**: AngularJS с RxJS для реактивных обновлений
- **Backend**: Entity Framework с индексами PostgreSQL
- **База данных**: индексы на `ExternalId`, `FoundByQueryId`, `PublishDate`
- **Кэширование**: нет (можно добавить Redis при необходимости)

## Дальнейшее развитие

1. **Аутентификация**: JWT токены для защиты API
2. **Уведомления**: email/telegram уведомления о новых тендерах
3. **Экспорт**: CSV/Excel экспорт найденных тендеров
4. **Аналитика**: графики и дашборды
5. **Распределенная обработка**: RabbitMQ для обработки больших объемов данных

## Лицензия

MIT License

## Контакты

Проект разработан в рамках технического задания на систему автоматизированного поиска тендеров.

---
*Система успешно развертывается командой `docker-compose up --build`*
