<!DOCTYPE html>
<html lang="ru" ng-app="tenderTrackerApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TenderTracker - –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="libs/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons (local) -->
    <link rel="stylesheet" href="libs/bootstrap-icons/font/bootstrap-icons.css">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìã</text></svg>">
    
    <!-- Custom CSS -->
    <style>
        body {
            padding-top: 20px;
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .card-header {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        .table-hover tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.1);
        }
        .badge-active {
            background-color: #28a745;
        }
        .badge-inactive {
            background-color: #6c757d;
        }
        .clickable {
            cursor: pointer;
            color: #007bff;
        }
        .clickable:hover {
            text-decoration: underline;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4 rounded">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="bi bi-search"></i> TenderTracker
                </a>
                <div class="navbar-text">
                    <small>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–Ω–¥–µ—Ä–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫</small>
                </div>
            </div>
        </nav>

        <!-- Error Alert -->
        <div class="alert alert-danger alert-dismissible fade show" role="alert" 
             ng-if="error" ng-controller="TenderListController">
            <strong>–û—à–∏–±–∫–∞!</strong> {{error}}
            <button type="button" class="btn-close" aria-label="Close" ng-click="clearError()"></button>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" ng-if="loading" ng-controller="TenderListController">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Left Column: Query Management -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-filter"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
                    </div>
                    <div class="card-body" ng-controller="QueryManagerController">
                        <!-- Add Query Form -->
                        <form ng-submit="addQuery()" class="mb-4">
                            <div class="mb-3">
                                <label for="keyword" class="form-label">–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ</label>
                                <input type="text" class="form-control" id="keyword" 
                                       ng-model="newQuery.keyword" 
                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ .NET" required>
                            </div>
                            <div class="mb-3">
                                <label for="category" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                <input type="text" class="form-control" id="category" 
                                       ng-model="newQuery.category" 
                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: IT">
                            </div>
                            <button type="submit" class="btn btn-primary" ng-disabled="loading">
                                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å
                            </button>
                        </form>

                        <!-- Queries List -->
                        <h6>–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:</h6>
                        <div class="list-group">
                            <div class="list-group-item" 
                                 ng-repeat="query in queries"
                                 ng-class="{'list-group-item-success': query.isActive, 'list-group-item-secondary': !query.isActive}">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>{{query.keyword}}</strong>
                                        <small class="text-muted d-block">{{query.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}}</small>
                                        <small class="text-muted">–î–æ–±–∞–≤–ª–µ–Ω: {{formatDate(query.createdAt)}}</small>
                                    </div>
                                    <div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" 
                                                   ng-model="query.isActive"
                                                   ng-change="toggleQuery(query)">
                                            <label class="form-check-label">
                                                <span class="badge" 
                                                      ng-class="query.isActive ? 'badge-active' : 'badge-inactive'">
                                                    {{query.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}}
                                                </span>
                                            </label>
                                        </div>
                                        <button class="btn btn-sm btn-outline-danger mt-1" 
                                                ng-click="deleteQuery(query.id)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group-item text-muted text-center" ng-if="queries.length === 0">
                                –ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Card -->
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-graph-up"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </div>
                    <div class="card-body" ng-controller="TenderListController">
                        <div class="text-center">
                            <h3>{{tenders.totalCount || 0}}</h3>
                            <p class="text-muted">–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ —Ç–µ–Ω–¥–µ—Ä–æ–≤</p>
                        </div>
                        <div class="text-center">
                            <small class="text-muted">
                                –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{formatDate(tenders.items[0] && tenders.items[0].savedAt) || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}}
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Tenders List -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-list-ul"></i> –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ—Ä—ã
                    </div>
                    <div class="card-body" ng-controller="TenderListController">
                        <!-- Filters -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" 
                                       ng-model="filters.search"
                                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –Ω–æ–º–µ—Ä—É...">
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" ng-model="filters.queryId">
                                    <option value="">–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã</option>
                                    <option ng-repeat="query in queries" value="{{query.id}}">
                                        {{query.keyword}}
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary w-100" ng-click="applyFilters()">
                                    <i class="bi bi-funnel"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                                </button>
                            </div>
                        </div>

                        <!-- Tenders Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th ng-click="sortBy('purchaseNumber')" class="clickable">
                                            –ù–æ–º–µ—Ä –∑–∞–∫—É–ø–∫–∏ <i class="bi" ng-class="getSortIcon('purchaseNumber')"></i>
                                        </th>
                                        <th ng-click="sortBy('title')" class="clickable">
                                            –ù–∞–∑–≤–∞–Ω–∏–µ <i class="bi" ng-class="getSortIcon('title')"></i>
                                        </th>
                                        <th>–ó–∞–∫–∞–∑—á–∏–∫</th>
                                        <th ng-click="sortBy('publishDate')" class="clickable">
                                            –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ <i class="bi" ng-class="getSortIcon('publishDate')"></i>
                                        </th>
                                        <th ng-click="sortBy('applicationDeadline')" class="clickable">
                                            –°—Ä–æ–∫ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–æ–∫ <i class="bi" ng-class="getSortIcon('applicationDeadline')"></i>
                                        </th>
                                        <th ng-click="sortBy('maxPrice')" class="clickable">
                                            –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ <i class="bi" ng-class="getSortIcon('maxPrice')"></i>
                                        </th>
                                        <th>–†–µ–≥–∏–æ–Ω</th>
                                        <th>–ù–∞–π–¥–µ–Ω –ø–æ –∑–∞–ø—Ä–æ—Å—É</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="tender in tenders.items">
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <a href="#" ng-click="openTenderLink(tender)" class="clickable me-2">
                                                    {{formatPurchaseNumber(tender)}}
                                                </a>
                                                <div class="dropdown">
                                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                                                            type="button" 
                                                            data-bs-toggle="dropdown" 
                                                            aria-expanded="false"
                                                            title="–í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–∏—Å–∫–∞">
                                                        <i class="bi bi-search"></i>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li>
                                                            <a class="dropdown-item" href="#" 
                                                               ng-click="openTenderLink(tender); $event.stopPropagation()">
                                                                <i class="bi bi-link-45deg"></i> –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a class="dropdown-item" href="#" 
                                                               ng-click="openSmartSearch(tender); $event.stopPropagation()">
                                                                <i class="bi bi-magic"></i> –£–º–Ω—ã–π –ø–æ–∏—Å–∫
                                                            </a>
                                                        </li>
                                                        <li><hr class="dropdown-divider"></li>
                                                        <li>
                                                            <a class="dropdown-item" href="#" 
                                                               ng-if="tender.purchaseNumber && tender.purchaseNumber !== 'N/A'"
                                                               ng-click="window.open('https://zakupki.gov.ru/epz/order/quicksearch/search.html?searchString=' + encodeURIComponent(tender.purchaseNumber), '_blank'); $event.stopPropagation()">
                                                                <i class="bi bi-123"></i> –¢–æ–ª—å–∫–æ –ø–æ –Ω–æ–º–µ—Ä—É
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a class="dropdown-item" href="#" 
                                                               ng-if="tender.title && tender.title !== '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'"
                                                               ng-click="window.open('https://zakupki.gov.ru/epz/order/quicksearch/search.html?searchString=' + encodeURIComponent(tender.title.substring(0, 50)), '_blank'); $event.stopPropagation()">
                                                                <i class="bi bi-text-paragraph"></i> –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a class="dropdown-item" href="#" 
                                                               ng-if="tender.customerName"
                                                               ng-click="window.open('https://zakupki.gov.ru/epz/order/quicksearch/search.html?searchString=' + encodeURIComponent(tender.customerName), '_blank'); $event.stopPropagation()">
                                                                <i class="bi bi-building"></i> –ü–æ –∑–∞–∫–∞–∑—á–∏–∫—É
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{{formatTitle(tender.title)}}</td>
                                        <td>{{formatCustomerName(tender.customerName)}}</td>
                                        <td>{{formatDate(tender.publishDate)}}</td>
                                        <td>
                                            <span ng-class="getDeadlineColorClass(tender.applicationDeadline)">
                                                {{formatDate(tender.applicationDeadline)}}
                                                <span ng-if="isDeadlineExpired(tender.applicationDeadline)" class="badge bg-danger ms-1">–ò—Å—Ç–µ–∫</span>
                                            </span>
                                        </td>
                                        <td>{{formatMaxPrice(tender.maxPrice)}}</td>
                                        <td>{{tender.region || '–ù–µ —É–∫–∞–∑–∞–Ω'}}</td>
                                        <td>
                                            <span class="badge bg-info">
                                                {{getQueryName(tender.foundByQueryId)}}
                                            </span>
                                        </td>
                                    </tr>
                                    <tr ng-if="tenders.items.length === 0">
                                        <td colspan="8" class="text-center text-muted">
                                            –ù–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ–Ω–¥–µ—Ä–æ–≤
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <select class="form-select form-select-sm w-auto d-inline-block" 
                                        ng-model="tenders.pageSize" 
                                        ng-change="changePageSize()">
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <span class="text-muted ms-2">–∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</span>
                            </div>
                            
                            <nav>
                                <ul class="pagination">
                                    <li class="page-item" ng-class="{disabled: tenders.page === 1}">
                                        <a class="page-link" href="#" ng-click="changePage(tenders.page - 1)">
                                            <i class="bi bi-chevron-left"></i>
                                        </a>
                                    </li>
                                    <li class="page-item" ng-repeat="page in [] | range:tenders.totalPages" 
                                        ng-class="{active: page === tenders.page}">
                                        <a class="page-link" href="#" ng-click="changePage(page)">
                                            {{page}}
                                        </a>
                                    </li>
                                    <li class="page-item" ng-class="{disabled: tenders.page === tenders.totalPages}">
                                        <a class="page-link" href="#" ng-click="changePage(tenders.page + 1)">
                                            <i class="bi bi-chevron-right"></i>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                            
                            <div class="text-muted">
                                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{tenders.page}} –∏–∑ {{tenders.totalPages}}
                                (–≤—Å–µ–≥–æ: {{tenders.totalCount}})
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Info Card -->
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    </div>
                    <div class="card-body">
                        <p>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç —Ç–µ–Ω–¥–µ—Ä—ã –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –∑–∞–ø—Ä–æ—Å–∞–º.</p>
                        <p>–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π —Ç–µ–Ω–¥–µ—Ä–∞ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–æ–º–µ—Ä –∑–∞–∫—É–ø–∫–∏.</p>
                        <p class="mb-0"><small>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ì–æ—Å–ü–ª–∞–Ω API v2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 1 –∑–∞–ø—Ä–æ—Å –≤ —Å–µ–∫—É–Ω–¥—É.</small></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-4 text-center text-muted">
            <hr>
            <p>TenderTracker &copy; 2024. –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–µ–Ω–¥–µ—Ä–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫.</p>
        </footer>
    </div>

    <!-- JavaScript Libraries -->
    <script src="libs/jquery/dist/jquery.min.js"></script>
    <script src="libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="libs/angular/angular.min.js"></script>
    <script src="libs/rxjs/bundles/rxjs.umd.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="app/app.js"></script>
    <script src="app/services/tender-api.service.js"></script>
    <script src="app/components/query-manager.controller.js"></script>
    <script src="app/components/tender-list.controller.js"></script>
    
    <!-- Custom Directives/Filters -->
    <script>
        // Additional filters or directives can be added here
    </script>
</body>
</html>
